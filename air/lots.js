import*as t from"https://cdn.jsdelivr.net/npm/d3@7/+esm";import a from"https://unpkg.com/moment@2.29.4/dist/moment.js";let lastModifiedId,parentId,width,last_airport,trans=()=>t.transition().duration(500);function addOuter(a,r,e,d){a.append("rect").attr("x",0).attr("y",0).attr("width",width).attr("height",40+9*(Math.ceil(e/d)+1)).attr("stroke","#325d88").attr("fill","white").attr("rx",3),a.append("line").attr("x1",0).attr("y1",40).attr("x2",width).attr("y2",40).attr("stroke","#325d88"),a.append("rect").attr("x",0).attr("y",0).attr("width",70).attr("height",30).attr("rx",6).attr("fill",r/e>=.99?"red":"blue").attr("transform",(t,a)=>`translate(${width-75} 5)`);a.append("g").attr("class","lots").selectAll("rect").data(t.range(e)).enter().append("rect").attr("x",(t,a)=>a%d*3).attr("y",t=>9*Math.floor(t/d)).attr("width",1).attr("height",7).attr("fill",t=>t<=r?"red":"blue").attr("transform",(t,a)=>"translate(7 45)")}function addEach(a,r,e,d){a.append("text").attr("x",10).attr("y",25).attr("fill",e/d>=.99?"red":"blue").text(r),a.append("text").attr("fill","white").attr("text-anchor","end").attr("transform",(t,a)=>`translate(${width-15} 18)`).text(t.format(".0%")(e/d)),a.append("text").attr("fill","white").attr("font-size",".8em").attr("text-anchor","end").attr("transform",(t,a)=>`translate(${width-10} 32)`).text(t.format(",")(e)+" / "+t.format(",")(d))}function addLot(t,a){let r=t.append("div").attr("class","lot"),e=Math.floor((width-10)/3);r.append("svg").attr("width",width).attr("height",40+9*(Math.ceil(a.total/e)+1)).append("g").call(addOuter,a.used,a.total,e).call(addEach,a.title,a.used,a.total)}function init(r){last_airport=r=r||"CJJ";let e=t.select(parentId);t.select(lastModifiedId).text(a(new Date).format("YYYY-MM-DD HH:mm:ss")),e.selectAll("svg").remove(),fetch("https://statkorea.modoree.kr/lots?branch="+r).then(async t=>{let a=await t.json();for(let r of a)addLot(e,r)}).catch(function(t){console.log(t)})}export default{parentEl:function(t){return parentId="#"+t.id,(width=t.offsetWidth)<=540&&(width=540),width-=40,this},lastModifiedId:function(t){return lastModifiedId="#"+t,this},reload:function(){init(last_airport)},build:function(t){return init(t),this}};