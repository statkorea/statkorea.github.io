import*as d3 from"https://cdn.jsdelivr.net/npm/d3@7/+esm";import moment from"https://unpkg.com/moment@2.29.4/dist/moment.js";let lastModifiedId,parentId,width,last_airport;const trans=()=>d3.transition().duration(500);function addOuter(t,a,r,e){let d=a/r;t.append("rect").attr("x",0).attr("y",0).attr("width",width).attr("height",40+9*(Math.ceil(r/e)+1)).attr("stroke","#325d88").attr("fill","white").attr("rx",3),t.append("line").attr("x1",0).attr("y1",40).attr("x2",width).attr("y2",40).attr("stroke","#325d88"),t.append("rect").attr("x",0).attr("y",0).attr("width",70).attr("height",30).attr("rx",6).attr("fill",d>=.99?"red":"blue").attr("transform",((t,a)=>`translate(${width-75} 5)`)),t.append("g").attr("class","lots").selectAll("rect").data(d3.range(r)).enter().append("rect").attr("x",((t,a)=>a%e*3)).attr("y",(t=>9*Math.floor(t/e))).attr("width",1).attr("height",7).attr("fill",(t=>t<=a?"red":"blue")).attr("transform",((t,a)=>"translate(7 45)"))}function addEach(t,a,r,e){let d=r/e;t.append("text").attr("x",10).attr("y",25).attr("fill",d>=.99?"red":"blue").text(a),t.append("text").attr("fill","white").attr("text-anchor","end").attr("transform",((t,a)=>`translate(${width-15} 18)`)).text(d3.format(".0%")(r/e)),t.append("text").attr("fill","white").attr("font-size",".8em").attr("text-anchor","end").attr("transform",((t,a)=>`translate(${width-10} 32)`)).text(d3.format(",")(r)+" / "+d3.format(",")(e))}function addLot(t,a){let r=t.append("div").attr("class","lot"),e=Math.floor((width-10)/3);r.append("svg").attr("width",width).attr("height",40+9*(Math.ceil(a.total/e)+1)).append("g").call(addOuter,a.used,a.total,e).call(addEach,a.title,a.used,a.total)}function init(t){last_airport=t=t||"CJJ";let a=d3.select(parentId);d3.select(lastModifiedId).text(moment(new Date).format("YYYY-MM-DD HH:mm:ss")),a.selectAll("svg").remove(),fetch("https://statkorea.modoree.kr/lots?branch="+t).then((async t=>{let r=await t.json();for(let t of r)addLot(a,t)})).catch((function(t){}))}export default{parentEl:function(t){return parentId="#"+t.id,width=t.offsetWidth,width<=540&&(width=540),width-=40,this},lastModifiedId:function(t){return lastModifiedId="#"+t,this},reload:function(){init(last_airport)},build:function(t){return init(t),this}};